<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XIZOA</title>
    <link href="https://fonts.googleapis.com/css2?family=Grand+Hotel&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-body: #fafafa; --bg-card: #ffffff; --text-main: #262626; --text-secondary: #8e8e8e;
            --border-color: #dbdbdb; --btn-primary: #0095f6; --btn-text: #ffffff;
        }
        [data-theme="dark"] {
            --bg-body: #000000; --bg-card: #000000; --text-main: #f5f5f5; --text-secondary: #a8a8a8;
            --border-color: #363636; --btn-primary: #0095f6;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, Roboto, sans-serif; }
        body { background-color: var(--bg-body); color: var(--text-main); min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .container { width: 100%; max-width: 350px; padding: 20px 0; }
        .card { background: var(--bg-card); border: 1px solid var(--border-color); padding: 40px 30px; margin-bottom: 10px; text-align: center; }
        .logo { font-family: 'Grand Hotel', cursive; font-size: 3rem; margin-bottom: 30px; }
        .btn { display: flex; align-items: center; justify-content: center; width: 100%; padding: 7px 16px; border-radius: 8px; font-weight: 600; cursor: pointer; text-decoration: none; margin-bottom: 12px; border: 1px solid transparent; }
        .btn-primary { background-color: var(--btn-primary); color: var(--btn-text); }
        .btn-github { background-color: #24292f; color: white; }
        .btn-google { background-color: transparent; border: 1px solid var(--border-color); color: var(--text-main); }
        .hidden { display: none !important; }
        .loader { border: 2px solid var(--bg-body); border-top: 2px solid var(--text-secondary); border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .profile-pic { width: 100px; height: 100px; border-radius: 50%; margin-bottom: 15px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1 class="logo">Xizoa</h1>
            <div id="loading" class="loader"></div>

            <div id="login-view" class="hidden">
                <p style="color: var(--text-secondary); margin-bottom: 20px;">Sign up to see photos from friends.</p>
                <a id="btn-github" href="#" class="btn btn-github">Log in with GitHub</a>
                <a id="btn-google" href="#" class="btn btn-google">Log in with Google</a>
            </div>

            <div id="profile-view" class="hidden">
                <img id="userAvatar" class="profile-pic" src="" alt="Profile">
                <h2 id="userLogin" style="font-size: 1.2rem;"></h2>
                <button id="logoutBtn" class="btn" style="color: #ed4956; background: none; margin-top: 20px;">Log Out</button>
            </div>
        </div>
    </div>

    <script>
        // ⚠️ IMPORTANT: Deploy backend first, then paste your worker URL here!
        // Example: const API_URL = 'https://api.your-name.workers.dev';
        const API_URL = 'https://api.xizoa.com'; 

        // Update Login Links automatically
        document.getElementById('btn-github').href = `${API_URL}/auth/github`;
        document.getElementById('btn-google').href = `${API_URL}/auth/google`;

        // Logic
        const views = { loading: document.getElementById('loading'), login: document.getElementById('login-view'), profile: document.getElementById('profile-view') };
        
        function switchView(view) {
            Object.values(views).forEach(el => el.classList.add('hidden'));
            views[view].classList.remove('hidden');
        }

        async function fetchMe() {
            try {
                const res = await fetch(`${API_URL}/me`, { method: 'GET', credentials: 'include' });
                if (!res.ok) throw new Error('Not auth');
                const data = await res.json();
                
                if (data.authenticated) {
                    document.getElementById('userLogin').textContent = data.user.login || data.user.name;
                    document.getElementById('userAvatar').src = data.user.avatar_url;
                    switchView('profile');
                } else {
                    switchView('login');
                }
            } catch {
                switchView('login');
            }
        }

        document.getElementById('logoutBtn').addEventListener('click', () => {
            document.cookie = "xizoa_session=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
            window.location.reload();
        });

        fetchMe();
    </script>
</body>
</html>
