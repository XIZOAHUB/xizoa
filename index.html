<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XIZOA</title>
    <link href="https://fonts.googleapis.com/css2?family=Grand+Hotel&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Instagram-like Clean CSS */
        :root { --bg: #fafafa; --card: #fff; --text: #262626; --btn: #0095f6; --border: #dbdbdb; }
        [data-theme="dark"] { --bg: #000; --card: #000; --text: #f5f5f5; --btn: #0095f6; --border: #363636; }
        
        body { background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { width: 100%; max-width: 350px; padding: 20px; }
        .card { background: var(--card); border: 1px solid var(--border); padding: 40px 20px; text-align: center; margin-bottom: 10px; }
        .logo { font-family: 'Grand Hotel', cursive; font-size: 3rem; margin-bottom: 30px; cursor: pointer; }
        
        .btn { display: block; width: 100%; padding: 8px; border-radius: 8px; font-weight: 600; text-decoration: none; margin-bottom: 10px; border: 1px solid transparent; cursor: pointer; }
        .btn-primary { background: var(--btn); color: white; }
        .btn-dark { background: #24292f; color: white; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text); }
        
        .profile-pic { width: 100px; height: 100px; border-radius: 50%; margin-bottom: 15px; border: 1px solid var(--border); }
        .hidden { display: none !important; }
        .error { color: red; font-size: 0.8rem; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="container">
        <div class="card">
            <h1 class="logo" onclick="location.reload()">Xizoa</h1>
            
            <div id="loading">Loading...</div>

            <div id="login-view" class="hidden">
                <p style="color:#8e8e8e; margin-bottom:20px;">Sign up to verify integration.</p>
                <a href="https://api.xizoa.com/auth/github" class="btn btn-dark">Log in with GitHub</a>
                <a href="#" class="btn btn-outline" onclick="alert('Google login coming soon!')">Log in with Google</a>
                <div id="error-msg" class="error"></div>
            </div>

            <div id="profile-view" class="hidden">
                <img id="u-img" class="profile-pic" src="">
                <h2 id="u-name" style="font-weight:300;"></h2>
                <p id="u-login" style="font-weight:600; margin-bottom:20px;"></p>
                <button class="btn btn-primary">Open App</button>
                <button class="btn" style="color:red; background:none;" onclick="logout()">Log Out</button>
            </div>
        </div>
    </div>

    <script>
        // ⚠️ DOMAINS CONFIGURATION
        const API_URL = 'https://api.xizoa.com';

        // 1. Check if User is Logged In
        async function checkUser() {
            try {
                // 'credentials: include' is CRITICAL for cookies to work across domains
                const res = await fetch(`${API_URL}/me`, { method: 'GET', credentials: 'include' });
                
                if (res.ok) {
                    const data = await res.json();
                    if (data.authenticated) {
                        showProfile(data.user);
                    } else {
                        showLogin();
                    }
                } else {
                    showLogin();
                }
            } catch (err) {
                console.error(err);
                showLogin();
                document.getElementById('error-msg').innerText = "⚠️ API Connection Failed. Check Console.";
            }
        }

        // 2. UI Helpers
        function showLogin() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('login-view').classList.remove('hidden');
        }

        function showProfile(user) {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('profile-view').classList.remove('hidden');
            
            document.getElementById('u-name').innerText = user.name || 'User';
            document.getElementById('u-login').innerText = '@' + user.login;
            document.getElementById('u-img').src = user.avatar_url || 'https://ui-avatars.com/api/?name=User';
        }

        // 3. Logout
        function logout() {
            // Clear cookie by setting past date
            document.cookie = "xizoa_session=; domain=.xizoa.com; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;";
            window.location.reload();
        }

        // Start
        checkUser();
    </script>
</body>
</html>
