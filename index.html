<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>X</title>

<style>
  body {
    font-family: system-ui, sans-serif;
    background: #0a0a0a;
    color: #fff;
    margin: 0;
    padding: 16px;
  }
  h2 { margin-top: 0; }
  input, textarea, button {
    width: 100%;
    padding: 10px;
    margin: 6px 0;
    border-radius: 6px;
    border: none;
  }
  input, textarea {
    background: #1a1a1a;
    color: #fff;
  }
  button {
    background: #00f7ff;
    color: #000;
    font-weight: bold;
    cursor: pointer;
  }
  .card {
    background: #111;
    padding: 12px;
    margin-bottom: 10px;
    border-radius: 8px;
  }
  .hidden { display: none; }
</style>
</head>

<body>

<h2>X</h2>

<!-- AUTH -->
<div id="auth">
  <input id="username" placeholder="username">
  <input id="password" type="password" placeholder="password">
  <button onclick="register()">Register</button>
  <button onclick="login()">Login</button>
</div>

<!-- APP -->
<div id="app" class="hidden">

  <textarea id="postContent" placeholder="Write something..."></textarea>
  <button onclick="createPost()">Post</button>

  <h3>Feed</h3>
  <div id="feed"></div>

</div>

<script>
const API = "https://api.xizoa.com"; // <-- CHANGE THIS
let currentUser = null;

async function register() {
  const res = await fetch(API + "/auth/register", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      username: username.value,
      password: password.value
    })
  });
  alert(await res.text());
}

async function login() {
  const res = await fetch(API + "/auth/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      username: username.value,
      password: password.value
    })
  });
  const data = await res.json();
  if (!data.success) return alert("Login failed");

  currentUser = data.user;
  auth.classList.add("hidden");
  app.classList.remove("hidden");
  loadFeed();
}

async function createPost() {
  await fetch(API + "/posts/create", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      user_id: currentUser.id,
      content: postContent.value
    })
  });
  postContent.value = "";
  loadFeed();
}

async function loadFeed() {
  const res = await fetch(API + "/feed");
  const posts = await res.json();
  feed.innerHTML = "";
  posts.forEach(p => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `<b>${p.username}</b><br>${p.content}`;
    feed.appendChild(div);
  });
}
</script>

</body>
</html>
